# Mazeon 開発者ドキュメント

## プロジェクト概要
Mazeonは協力型迷路攻略ゲームです。フロントエンドはReact Native、バックエンドはNode.js（Express + Socket.IO）で構築しています。

## プロジェクト構造とファイル説明

### ルートディレクトリ
```
Mazeon/
├── package.json           # RNアプリの依存・スクリプト（frontend）
├── metro.config.js        # Metro bundler設定
├── babel.config.js        # Babel設定（reanimated plugin等）
├── index.js               # RNアプリのエントリーポイント
├── app.json               # アプリ名・表示名
├── .gitignore             # Git除外設定
├── README.md              # プロジェクト概要（ユーザー向け）
├── setup.md               # セットアップ手順（ユーザー/開発者向け）
├── backend/               # バックエンド（Node.js/Express/Socket.IO）
└── src/                   # フロントエンド（React Native）
```

### フロントエンド `src/`
```
src/
├── App.js                 # ルートコンポーネント（Navigation/Providers）
├── screens/               # 画面コンポーネント
│   ├── HomeScreen.js      # ホーム（部屋作成/参加）
│   ├── LobbyScreen.js     # ロビー（参加者/開始）
│   └── GameScreen.js      # ゲーム（迷路描画/操作）
├── context/
│   └── GameContext.js     # ゲーム状態/Socket接続管理
├── config/
│   └── GameConfig.js      # ゲーム/UI/音/ネットワーク設定、定数群
├── constants/
│   └── GameConstants.js   # ゲームで共通利用する定数（状態/イベント他）
├── utils/
│   └── GameUtils.js       # 汎用関数（スケール/時間/座標/ログ等）
├── services/
│   ├── AudioService.js    # 音声の読み込み/再生/解放を管理
│   └── StorageService.js  # AsyncStorageラッパ（設定/進行/統計/スコア）
├── hooks/
│   └── GameHooks.js       # カスタムフック（ループ/タイマー/入力/統計等）
├── components/
│   └── GameComponents.js  # 共通UI（ボタン/バッジ/プログレス/タイマー等）
└── assets/
    ├── images/            # 画像アセット（READMEあり）
    │   └── README.md
    └── sounds/            # 音声アセット（READMEあり）
        └── README.md
```

### バックエンド `backend/`
```
backend/
├── package.json           # 依存・スクリプト（start/dev/test）
├── server.js              # Express + Socket.IO（ゲームルーム/迷路生成）
├── env.example            # 環境変数サンプル（.envはgit管理外）
└── DevDocuments/          # 開発ドキュメント（本番管理用）
    ├── README.md          # 文書索引/参照順序/更新手順
    ├── 概要.md             # 本ファイル（概要/構造/説明）
    ├── 注意点.md           # 絶対遵守のベストプラクティス
    └── AI_UPDATE_RULES.md # AI更新ルール/参照ポリシー
```

## 各ファイルの詳細説明

### フロントエンド（React Native）
- `App.js`
  - 役割: アプリのルート。`SafeArea`/`GestureHandler`/`GameProvider`/`Navigation` のラップ
  - 要点: 画面追加時はStackにRouteを追加
- `context/GameContext.js`
  - 役割: ゲーム状態、Socket.IOクライアント、イベント購読/発火
  - 要点: 接続は単一インスタンスで管理、`useEffect`で購読解除を徹底
- `config/GameConfig.js`
  - 役割: ゲーム/迷路/UI/音/ネットワーク/デバッグ設定、難易度/ローカライズ
  - 要点: 環境・ビルドごとの差分はここで切替
- `constants/GameConstants.js`
  - 役割: ゲーム状態/イベント/アイテム/タイル/難易度 等の定数
  - 要点: フロント/バックのイベント契約はここを基準に整合
- `utils/GameUtils.js`
  - 役割: スケール、時間、座標、乱数、デバウンス/スロットル、ログ/計測 など
  - 要点: UIスレッドを塞がない範囲で使用、重い処理は分割
- `services/AudioService.js`
  - 役割: 効果音/音楽のプリロード、再生、音量、解放
  - 要点: 未使用時は `release()` を徹底
- `services/StorageService.js`
  - 役割: AsyncStorageの高水準API（設定/統計/進行/スコア）
  - 要点: 名前空間プリフィクスで衝突回避
- `hooks/GameHooks.js`
  - 役割: ゲームループ、タイマー、入力、状態遷移、統計、設定、パフォーマンス監視、エラー収集
  - 要点: `requestAnimationFrame`利用とクリーンアップを厳守
- `components/GameComponents.js`
  - 役割: 再利用UI（ボタン/カード/バッジ/プログレス/タイマー/ラベル等）
  - 要点: `GameConfig.ui` を用いた一貫した見た目
- `assets/images` / `assets/sounds`
  - 役割: アセット置き場。各READMEに命名規則/サイズ/最適化を記載

### バックエンド（Node.js）
- `backend/server.js`
  - 役割: Expressサーバ、Socket.IOイベント、迷路生成、ルーム/プレイヤー管理
  - 要点: クライアントとイベント名/ペイロードを合意。`/api/health` 等を提供
- `backend/env.example`
  - 役割: `.env`の雛形（`PORT`/`NODE_ENV`）。実ファイルはgit管理外
- `backend/DevDocuments/*`
  - `README.md`: 文書索引と参照順序
  - `概要.md`: 本ファイル。構成と説明の最新ソース
  - `注意点.md`: 絶対遵守の実装・運用チェックリスト
  - `AI_UPDATE_RULES.md`: AI/人手の変更手順、参照ポリシー、PRテンプレ

## 参照と更新の指針
- 参照順序: 1) `backend/DevDocuments/注意点.md` → 2) `backend/DevDocuments/AI_UPDATE_RULES.md` → 3) 本ファイル（概要） → 4) ルート `README.md`/`setup.md`
- 更新時: 既存 `config/constants/utils/services/hooks/components` を優先再利用。重複実装は禁止
- 仕様・契約変更: `注意点.md` と `AI_UPDATE_RULES.md` を先に更新し、本ファイルの構成図も追随

## 開発の基本フロー（要約）
1. 依存のインストール: ルート → `backend`
2. 環境変数: `backend/env.example` を `.env` にコピーし設定
3. 起動: `npm run dev`（同時起動）または 個別に `npm run start` / `cd backend && npm start`
4. 実装: 画面追加→`App.js`ルーティング、状態/サービスは責務分離に従う
5. 検証: 低性能端末/長時間プレイでFPS・メモリ・発熱を確認
6. ドキュメント: 変更点を `注意点.md`/`AI_UPDATE_RULES.md`/本ファイルへ反映

## ライセンス
MIT License
