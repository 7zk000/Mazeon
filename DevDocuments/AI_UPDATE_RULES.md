# AI更新ルール・参照ポリシー（必読）

本ドキュメントは、AI/人間いずれの更新でも守るべき運用ルールを定義します。類似/詳細ドキュメントは `backend/DevDocuments/注意点.md`、`backend/DevDocuments/dev.md`（存在する場合）、`setup.md`、`README.md` を参照してください。

## 1. 変更の原則
- 単一責務: 1コミット/PRは1つの目的に限定
- 追跡可能性: なぜ必要か、どの仕様/課題に紐づくかを説明
- 可逆性: 変更はロールバックしやすく（設定の切替可能・フラグ化）
- 既存再利用: 既存の `config/constants/utils/services/hooks/components` を最優先で再利用。重複実装は禁止

## 2. 参照ポリシー（重複防止）
- まず以下を検索して該当箇所を再利用/更新
  1) `src/config/GameConfig.js`
  2) `src/constants/GameConstants.js`
  3) `src/utils/GameUtils.js`
  4) `src/services/*`
  5) `src/hooks/*`
  6) `backend/server.js`（プロトコル・イベント）
- 同等/類似の関数・定数を新規作成せず、拡張が必要なら既存へ統合
- ドキュメントは `注意点.md` を最優先参照。詳細は `dev.md` と本書を併読

## 3. 設計・命名・配置規約
- 配置: 設定→`config`、定数→`constants`、共通関数→`utils`、外部I/O→`services`、UI→`components`、Reactロジック→`hooks`
- 命名: ファイル/識別子は用途を表す完全な英単語。略語禁止（一般的な略語除く）
- エクスポート: モジュールの公開APIを明確化（不要な内部実装を公開しない）

## 4. パフォーマンス・品質
- レンダリング最適化（memo/memoization）とUIスレッド非ブロックを厳守
- アニメーションは `react-native-reanimated`、リストは `FlatList` を原則使用
- 画像・音声はプリロード、未使用時解放、アセット規約に準拠
- 低性能端末での体感を重視し、60fps/電池消費/発熱を考慮

## 5. ネットワーク・イベント契約
- Socket.IOのイベント名/ペイロードは `constants` に集約し、フロント/サーバで共通化
- 互換性のない変更はバージョン付きイベント名を導入（例: `playerMove:v2`）
- 例外・リトライ・再接続（指数バックオフ）を必ず実装

## 6. セキュリティ・設定管理
- 機密情報は `.env`（`backend/env.example` を雛形に）で管理、コード直書き禁止
- エンドポイント/URLは `GameConfig.network` 経由で環境切替
- 信頼できない入力はサーバ側で再検証

## 7. テスト・チェック
- 重要ロジック（移動/衝突/タイマー/同期）はユニットテスト必須
- PR前に lint/test/build を通し、警告/エラー0
- 長時間動作でメモリリーク/発熱確認

## 8. ドキュメント運用
- 変更が設定/定数/プロトコル/公開API/アセット規約に影響する場合:
  - `注意点.md` と本書（AI更新ルール）を更新
  - `dev.md`（存在する場合）に変更箇所を追記
- 類似ドキュメントがある場合は重複記述を避け、「参照」リンクを追記

## 9. 変更申請テンプレ（PR/コミットメッセージ）
```
feat: XXX を追加（目的）
- 背景: {課題/要望/仕様}
- 参照: 注意点.md の {節}、GameConfig、GameConstants
- 影響: API/イベント/設定（変更/追加/互換性）
- テスト: カバレッジ/手動確認
```

## 10. バージョニング/フラグ
- 破壊的変更はメジャー、機能追加はマイナー、修正はパッチ
- リリース前は機能フラグで切替可能に実装

## 11. 変更履歴テンプレ
```
## YYYY-MM-DD Author
- 変更: ...
- 理由: ...
- 参照: 注意点.md / dev.md / GameConfig / GameConstants
```

---
本書は将来のAI更新時に必ず参照し、重複・逸脱・劣化を防止してください。
